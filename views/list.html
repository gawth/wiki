{{template "header" "Wiki"}}

<script>
    (function(history){
	var pushState = history.pushState;
	history.pushState = function(state, title, url) {
	  console.log(state, title, url);
	  return pushState.apply(history, arguments);
	};
    })(window.history);

    function renderTitle(data) {
	return '<a href="/wiki/view/' + data +'">' + data + '</a>'
    }
    function renderElement(data) {
	return '<div>' + data + '</div>'
    }
    function renderWiki(data) {
	return '<div>' + 
	    renderTitle(data.Title) + 
	    renderElement(data.Body) + 
	    renderElement(data.Modified) + 
	    '</div>'
    }
    async function getWiki(that) {
	let name = that.wikiName.value
	let response = await fetch('/api?wiki=' + name)
	if (response.status != 200) {
	    document.getElementById("wiki").innerHTML = 'Unknown Wiki'
	    return false
	}

	let data = await response.json()
	document.getElementById("wiki").innerHTML = renderWiki(data)
	window.history.pushState('listpage', data.Title, data.Title);
	return false
    }

</script>

<body>

    {{template "leftnav" .}}
    <div class="content">
        <h1> List </h1>
        <!-- -->
	<form onsubmit="getWiki(this); return false">
	    Wiki: <input type="text" name="wikiName">
	    <button>Submit</button>
	</form>
	<p id="wiki"></p>
        {{template "footer"}}
    </div>
</body>


</html>
